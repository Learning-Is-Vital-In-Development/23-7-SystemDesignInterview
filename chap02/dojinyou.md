# 2. 개략적인 규모 추정

개략적인 규모 추정을 효과적으로 해 내려면 규모 확장성을 표현하는 데 필요한 기본기에 능숙해야 한다.

특히, 2의 제곱수나 응답지연(latency) 값, 그리고 가용성에 관계된 수치들을 기본적으로 잘 이해하고 있어야 한다.

## 2의 제곱수

- 최소 단위는 `1바이트`이고 `8비트`로 구성된다.
- ASCII 문자 하나가 차지하는 메모리 키기가 `1바이트`이다.
- 1KB(=$2^{10}$) / 1MB(=$2^{20}$) / 1GB(=$2^{30}$) / 1TB(=$2^{40}$) / 1PB(=$2^{50}$)

## 응답 지연(Latency) 값

- 0.5 ns - L1 캐시 참조
- 5 ns - 분기 예측 오류(branch mispredict)
- 7 ns - L2 캐시 참조
- $10^2$ ns - 뮤텍스(mutex) 락,언락 / 주 메모리 참조
- $10^4$ ns - Zippy로 1 KB 압축
- $2 * 10^4$ ns - 1 Gbps 네트워크로 2 KB 전송
- 0.25 ms - 메모리에서 1 MB 순차적으로 read
- 0.5 ms - 같은 데이터 센터 내에서의 메서지 왕복 지연시간
- 10 ms - 디스크 탐색(seek) / 네트워크에서 1mb 순차적으로 read
- 30 ms - 디스크에서 1mb 순차적으로 read
- 150 ms - 한 패킷이 캘리포니아로부터 네덜란드까지의 왕복 지연시간

**결론**

→ 메모리는 빠르지만 디스크는 아직도 느리다.

→ 디스크 탐색(seek)은 가능한 한 피하라.

→ 단순한 압축 알고리즘은 빠르다. 데이터를 인터넷으로 전송하기 전에 가능하면 압축하라.

→ 데이터 센터는 보통 여러 지역(region)에 분산되어 있고, 센터들 간에 데이터를 주고받는 데는 시간이 걸린다.

## 가용성에 관계된 수치들

고가용성(high availability)은 시스템이 오랜 시간 동안 지속적으로 중단 없이 운영될 수 있는 능력을 지칭하는 용어다. 고가용성을 표현하는 값을 퍼센트로 표현하는데 100%는 `단 한 번도 중단된 적이 없었음`을 의미한다.

SLA(Service Level Agreement)는 사업스 사업자가 제공하는 서비스의 가용시간(uptime)을 의미한다. 아마존, 구글, 마이크로소프트 같은 사업자들은 99% 이상 SLA를 제공한다.

### 예제: 트위터 QPS와 저장소 요구량 추정

**가정**

- 월간 능동 사용자(monthly active user)는 3억(300 milion) 명이다.
- 50%의 사용자가 트위터를 매일 사용한다.
- 평균적으로 각 사용자는 매일 2건의 트윗을 올린다.
- 미디어를 포함하는 트윗은 10% 정도다.
- 데이터는 5년 간 보관된다.

**추정**

- QPS(Query Per Second) 추정치
    - 일간 능동 사용자(Daily Active User, DAU) = 3억 x 50% = 1.5억
    - QPS = 1.5억 x 2 트윗 / 24시간 / 3600초 = 약 3500
    - 최대 QPS(Peek QPS) = 2 x QPS = 700
- 미디어 저장을 위한 저장소 요구량
    - 평균 트윗 크기
        - tweet_id에 64바이트
        - 텍스트에 140바이트
        - 미디어에 1mb
    - 미디어 저장소 요구량: 1.5억 x 2 x 10% x 1MB = 30TB/일
    - 5년간 미디어를 보관하기 위한 저장소 요구량: 30TBx365x5 = 약 55PB

### 팁

올바른 절차를 밟느냐가 결과를 내는 것보다 중요하다. 면접자가 보고 싶어 하는 것은 문제 해결 능력일 것이다.

- 근사치를 활용한 계산(rounding and approximation): 면접장에서 복잡한 계산을 하는 것은 어려운 일이다. 복잡한 계산은 근사화를 하여 간소화시키자.
- 가정(assumption)들은 적어두라. 나중에 살펴볼 수 있도록
- 단위(unit)를 붙이라. 5라고만 적으면 5KB인지 5MB인지 알 수 없다.
- 많이 출제되는 개략적인 규모 추정 문제는 QPS, 최대 QPS, 저장소 요구량, 캐시 요구량, 서버 수 등을 추정하는 것이다.
